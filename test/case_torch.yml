- name: test if torch installed
  find:
    path: /usr/local/python3.7.5/lib
    recurse: yes
    file_type: directory
    use_regex: yes
    patterns: "torch.*ascend"
  register: torch_ascend

- name: message
  debug:
    msg:
    - "torch for ascend not installed"
  when: torch_ascend.matched == 0

- name: test import torch
  shell: python3.7 -c "import torch; print(torch.__version__)"
  environment:
    PATH: /usr/local/python3.7.5/bin:{{ ansible_env.PATH }}
    LD_LIBRARY_PATH: /usr/local/python3.7.5/lib:/usr/local/Ascend/ascend-toolkit/latest/fwkacllib/lib64:/usr/local/Ascend/nnae/latest/fwkacllib/lib64:/usr/local/gcc7.3.0/lib64:/usr/local/Ascend/develop/lib64:/usr/local/Ascend/ascend-toolkit/latest/arm64-linux/atc/lib64:/usr/local/Ascend/ascend-toolkit/latest/x86-linux/atc/lib64
  register: import_torch
  when: torch_ascend.matched > 0
  changed_when: false

- name: print import torch result
  debug: var=import_torch
  when: torch_ascend.matched > 0
