- name: message
  debug:
    msg:
      - "not support uninstall atlasedge with uninstall_version"
  failed_when: true
  when:
    - uninstall_version != ""

- name: find atlasedge uninstall file path
  find:
    paths: "/usr/local/AtlasEdge/"
    recurse: no
    file_type: file
    use_regex: yes
    patterns: "run.sh$"
  register: uninstall_atlasedge
  when: uninstall_version == ""

- name: message
  debug:
    msg:
      - "atlasedge is not installed, atlasedge uninstall skipped"
  when:
    - uninstall_version == ""
    - uninstall_atlasedge.matched == 0

- name: uninstall atlasedge
  shell: "{{ uninstall_atlasedge.files[0].path }} uninstall"
  register: result
  when:
    - uninstall_version == ""
    - uninstall_atlasedge.matched > 0
  failed_when: result.rc != 0

- name: show uninstall result
  debug: var=result
  when:
    - uninstall_version == ""
    - result.changed
