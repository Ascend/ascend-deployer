- name: message
  debug:
    msg:
      - "not support uninstall ha with uninstall_version"
  failed_when: true
  when:
    - uninstall_version != ""

- name: find ha uninstall file path
  find:
    paths: "/usr/local/ha/"
    recurse: no
    file_type: file
    use_regex: yes
    patterns: "uninstall.sh$"
  register: uninstall_ha
  when: uninstall_version == ""

- name: message
  debug:
    msg:
      - "ha is not installed, ha uninstall skipped"
  when:
    - uninstall_version == ""
    - uninstall_ha.matched == 0

- name: uninstall ha
  shell: "{{ uninstall_ha.files[0].path }} -q"
  register: result
  when:
    - uninstall_version == ""
    - uninstall_ha.matched > 0
  failed_when: result.rc != 0

- name: show uninstall result
  debug: var=result
  when:
    - uninstall_version == ""
    - result.changed
