- name: message
  debug:
    msg:
      - "not support uninstall driver with uninstall_version"
  failed_when: true
  when:
    - uninstall_version != ""

- name: find uninstall.sh in driver
  shell: find /usr/local/Ascend/driver/ -type f | grep -E "/script/uninstall.sh" | head -n 1
  register: uninstall_driver
  when: uninstall_version == ""

- name: message
  debug:
    msg:
      - "driver is not installed, driver uninstall skipped"
  when:
    - uninstall_version == ""
    - uninstall_driver.stdout == ''

- name: uninstall driver
  shell: "{{ uninstall_driver.stdout }}"
  register: result
  when:
    - uninstall_version == ""
    - uninstall_driver.rc == 0
    - uninstall_driver.stdout != ''
  failed_when: result.rc != 0

- name: show uninstall result
  debug: var=result
  when:
    - uninstall_version == ""
    - result.changed
