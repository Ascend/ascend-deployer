- hosts: localhost
  vars:
    host_count: "{{ groups[hosts_name] | length }}"
    first_host: "{{ groups[hosts_name][0] }}"
  tasks:
    - name: set resouces_dir locally
      set_fact:
        resources_dir: "../resources"
        cacheable: yes

    - name: make tar package for remote
      shell: tar -cf ~/resources.tar ../resources
      when: not (host_count == "1" and first_host == "localhost")

- hosts: '{{ hosts_name }}'
  tasks:
    - name: set resouces_dir remote
      set_fact:
        resources_dir: "~/resources"
        cacheable: yes
      when: ansible_connection != "local"

    - name: copy to remote hosts
      copy:
        src: ~/resources.tar
        dest: ~/
      when: ansible_connection != "local"

    - name: uncompress on remote
      unarchive:
        src: ~/resources.tar
        dest: ~/
        copy: no
      when: ansible_connection != "local"
