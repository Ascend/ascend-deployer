- hosts: '{{ hosts_name }}'
  tasks:
    - name: upgrade pip
      shell: python3.7 -m pip install --upgrade pip --no-index --find-links ~/resources/`uname -m`
      environment:
        PATH: /usr/local/python3.7.5/bin:"{{lookup('env', 'PATH')}}"
        LD_LIBRARY_PATH: /usr/local/python3.7.5/lib:/usr/local/gcc7.3.0/lib64

    - name: install cython
      shell: python3.7 -m pip install cython ~/resource/`uname -m`
      environment:
        PATH: /usr/local/python3.7.5/bin:"{{lookup('env', 'PATH')}}"
        LD_LIBRARY_PATH: /usr/local/python3.7.5/lib:/usr/local/gcc7.3.0/lib64

    - name: install pkgconfig
      shell: python3.7 -m pip install pkgconfig ~/resource/`uname -m`
      environment:
        PATH: /usr/local/python3.7.5/bin:"{{lookup('env', 'PATH')}}"
        LD_LIBRARY_PATH: /usr/local/python3.7.5/lib:/usr/local/gcc7.3.0/lib64

    - name: link hdf5 for ubuntu
      shell: ln -s /usr/lib/`uname -m`-linux-gnu/libhdf5_serial.so /usr/lib/`uname -m`-linux-gnu/libhdf5.so
      when: ansible_pkg_mgr == 'apt'


    - name: link hdf5 for centos
      shell: ln -s `find /usr/lib64/ -type f -name "libhdf5.so*"` /usr/lib64/libhdf5.so
      when: ansible_pkg_mgr == 'yum' or ansible_pkg_mgr == 'dnf'

    - name: install tensorflow
      shell: python3.7 -m pip install tensorflow --no-index --find-links ~/resources/`uname -m`
      environment:
        PATH: /usr/local/python3.7.5/bin:"{{lookup('env', 'PATH')}}"
        LD_LIBRARY_PATH: /usr/local/python3.7.5/lib:/usr/local/gcc7.3.0/lib64
