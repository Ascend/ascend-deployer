- name: create build directory
  file:
    path: ~/build
    state: directory
    recurse: yes

- name: uncompress protobuf
  unarchive:
    src: "{{ resources_dir }}/protobuf-python-3.11.3.tar.gz"
    dest: ~/build
    copy: no

- name: configure protobuf
  shell: ./configure --prefix=/usr/local
  args:
    chdir: ~/build/protobuf-3.11.3

- name: make protobuf
  shell: make -C ~/build/protobuf-3.11.3 -j 10
  ignore_errors: yes  

- name: make install protobuf
  shell: make -C ~/build/protobuf-3.11.3 install
  become: yes
